<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Cart - Glickmate</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #F2F0EF;
        color: #000;
        margin: 0;
        transition: background-color .35s ease, color .35s ease;
    }

    h1 { text-align: center; color: brown; margin-bottom: 1rem; }

    #header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: brown;
        height: 75px;
        padding: 0 20px;
        transition: background-color .35s ease, color .35s ease;
    }

    #header-1 h2 { color: yellow; margin: 0; font-size: 24px; }

    #header-2 {
        display: flex;
        gap: 20px;
        align-items: center;
        font-size: 20px;
    }

    #header-2 a {
        color: yellow;
        text-decoration: none;
    }

   
    .theme-toggle-icon {
        font-size: 28px;
        cursor: pointer;
        transition: transform 0.35s ease;
    }
    .theme-toggle-icon:hover { transform: scale(1.1); }

    .main-content {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 40px;
        margin-top: 40px;
    }

    #logo-left {
        width: 150px;
    }

    .cart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-top: 1rem;
    }

    .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: brown;
        color: yellow;
        width: 90%;
        max-width: 600px;
        padding: 10px 20px;
        border-radius: 10px;
        transition: background-color .35s ease, color .35s ease;
    }

    .cart-item img {
        width: 100px;
        border-radius: 10px;
    }

    button {
        background-color: yellow;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s ease;
    }

    button:hover { transform: scale(1.05); }

    
    #hidden-box {
        display: none;
        flex-direction: column;
        align-items: center;
        background-color: brown;
        color: yellow;
        width: 90%;
        max-width: 600px;
        margin: 30px auto;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        gap: 10px;
        transition: background-color .35s ease, color .35s ease;
    }

    #hidden-box input {
        width: 90%;
        padding: 10px;
        border-radius: 10px;
        border: none;
        font-size: 14px;
    }

    #hidden-box input:focus {
        outline: 2px solid yellow;
    }

    
    #coupon-container {
        text-align: center;
        margin-top: 20px;
    }

    #discountText {
        color: brown;
        font-weight: bold;
        margin-top: 10px;
    }

  
    body.dark-mode {
        background-color: #121212;
        color: #f0f0f0;
    }

    body.dark-mode h1 {
        color: #ffcc00;
    }

    body.dark-mode #header {
        background-color: #1e1e1e;
        color: #fff;
    }

    body.dark-mode #header-2 a {
        color: #ffcc00;
    }

    body.dark-mode .cart-item {
        background-color: #222;
        color: #ffcc00;
    }

    body.dark-mode #hidden-box {
        background-color: #222;
        color: #ffcc00;
    }

    body.dark-mode #discountText {
        color: #ffcc00;
    }
</style>
</head>

<body>


<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>


<div id="header">
    <div id="header-1"><h2>Glickmate</h2></div>

    <div id="header-2">
        <a href="index.html">Home</a>
        <a href="cart.html">Cart</a>
        <a href="signup/signup.html">Sign up</a>
        <a href="login/login.html">Login</a>

        <ion-icon id="dark-toggle" class="theme-toggle-icon" name="moon"></ion-icon>
        <ion-icon id="light-toggle" class="theme-toggle-icon" name="sunny" style="display:none;"></ion-icon>
    </div>
</div>


<div class="main-content">
    <img src="Images/tplogo.png" id="logo-left">
    <div>
        <h1>Your Cart</h1>
        <div class="cart-container" id="cartContainer"></div>
        <div id="totalDiv" style="color:brown;font-weight:bold;margin-top:10px;"></div>
        <button id="purchase">Purchase</button>
    </div>
</div>


<div id="coupon-container">
    <input id="couponInput" type="text" placeholder="Enter Coupon Code"
           style="padding:10px;border-radius:10px;border:1px solid brown;">
    <button onclick="applyCoupon()">Apply Coupon</button>
    <p id="discountText"></p>
</div>


<div id="hidden-box">
    <input type="text" placeholder="Address" required>
    <input type="text" id="cardNumber" maxlength="16" inputmode="numeric" placeholder="Card Number">
    <input type="text" id="cvv" maxlength="3" inputmode="numeric" placeholder="CVV">
    <input type="text" placeholder="Exp. Date (MM/YY)">
    <input type="text" placeholder="Card Holder Name">
    <input type="text" placeholder="Name On Order">
    <button type="submit">Submit</button>
    <p>or</p>
    <button id="cash">Cash</button>
</div>


<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let appliedCoupon = JSON.parse(localStorage.getItem('appliedCoupon')) || null;

function renderCart() {
    const container = document.getElementById('cartContainer');
    container.innerHTML = '';

    if (cart.length === 0) {
        container.innerHTML = "<p>Your cart is empty!</p>";
        document.getElementById('totalDiv').textContent = '';
        return;
    }

    cart.forEach((item, index) => {
        const div = document.createElement('div');
        div.classList.add('cart-item');
        div.innerHTML = `
            <img src="${item.image}">
            <p>${item.name}</p>
            <p>$${item.price.toFixed(2)}</p>
            <input type="number" min="1" value="${item.quantity}" 
                   style="width:60px;padding:5px;border-radius:5px;"
                   onchange="updateQuantity(${index}, this.value)">
            <button onclick="removeItem(${index})">Remove</button>
        `;
        container.appendChild(div);
    });

    updateTotal();
}

function updateQuantity(index, qty) {
    cart[index].quantity = Math.max(1, parseInt(qty));
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
}

function removeItem(index) {
    cart.splice(index, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
}

function calculateTotal() {
    let total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

    if (appliedCoupon) {
        if (appliedCoupon.type === "percent")
            total *= (1 - appliedCoupon.amount / 100);
        else
            total -= appliedCoupon.amount;

        if (total < 0) total = 0;
    }

    return total.toFixed(2);
}

function updateTotal() {
    document.getElementById('totalDiv').textContent = `Total: $${calculateTotal()}`;
}

function applyCoupon() {
    const code = document.getElementById('couponInput').value.trim().toUpperCase();
    const coupons = JSON.parse(localStorage.getItem('glickCoupons')) || [];
    const match = coupons.find(c => c.code === code);

    if (!match) return alert("Invalid coupon code.");

    appliedCoupon = match;
    localStorage.setItem('appliedCoupon', JSON.stringify(appliedCoupon));

    document.getElementById('discountText').textContent =
        `Coupon Applied: ${appliedCoupon.code}`;

    updateTotal();
}

function showPurchaseAlert(method) {
    if (cart.length === 0) return alert("Your cart is empty.");

    let msg = "Thank you for your purchase!\n---------------------------------\nItems Purchased:\n\n";
    let total = 0;

    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        msg += `${item.name} — Qty: ${item.quantity} — $${item.price.toFixed(2)} each\nSubtotal: $${itemTotal.toFixed(2)}\n\n`;
    });

    if (appliedCoupon) {
        if (appliedCoupon.type === "percent")
            total *= (1 - appliedCoupon.amount / 100);
        else
            total -= appliedCoupon.amount;
    }

    msg += "---------------------------------\n";
    msg += `Total: $${total.toFixed(2)}\n`;
    msg += `Payment Method: ${method}\n`;
    msg += "---------------------------------";

    alert(msg);

    cart = [];
    localStorage.removeItem('cart');
    localStorage.removeItem('appliedCoupon');
    appliedCoupon = null;

    renderCart();
    document.getElementById('discountText').textContent = '';
    document.getElementById('hidden-box').style.display = 'none';
}

document.getElementById('cash').addEventListener('click',
    () => showPurchaseAlert("Cash"));

document.getElementById('purchase').addEventListener('click', () => {
    const box = document.getElementById('hidden-box');
    box.style.display = box.style.display === "flex" ? "none" : "flex";
});

document.querySelector('#hidden-box button[type="submit"]').addEventListener('click', () => {
    const inputs = document.querySelectorAll('#hidden-box input');
    for (let input of inputs) {
        if (!input.value.trim()) return alert("Please fill in all fields.");
    }
    showPurchaseAlert("Card");
});

// Dark mode toggle
const darkToggle = document.getElementById('dark-toggle');
const lightToggle = document.getElementById('light-toggle');

darkToggle.addEventListener('click', () => {
    document.body.classList.add('dark-mode');
    darkToggle.style.display = "none";
    lightToggle.style.display = "inline-block";
});

lightToggle.addEventListener('click', () => {
    document.body.classList.remove('dark-mode');
    lightToggle.style.display = "none";
    darkToggle.style.display = "inline-block";
});

renderCart();
</script>

</body>
</html>
